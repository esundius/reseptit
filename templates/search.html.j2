{% extends "base.html.j2" %}
{% block title %}Search recipes{% endblock %}
{% block head %}
  {{ super() }}
  <style>
  </style>
{% endblock %}
{% block menu %}
  {{ super() }}
{% endblock %}
{% block flash %}
  {{ super() }}
{% endblock %}
{% block body %}
  <h1>Search recipes</h1>
  <form action="/search" method="get">
    <p>
      <label for="query">Search in recipe name and content</label>:
      {% if query %}
        <input type="text" id="query" name="query" value="{{ query }}" />
      {% else %}
        <input type="text" id="query" name="query" />
      {% endif %}
    </p>
    {% if all_tags %}
      <p>
        <label for="tags">Filter by tags (when selecting multiple tags, any will match):</label>
        <br />
        {% for tag in all_tags %}
          <label>
            <input type="checkbox" name="tags" value="{{ tag.name }}" {% if tag.name in request.args.getlist('tags') %}checked{% endif %}>
            {{ tag.name }}
          </label>
        {% endfor %}
      </p>
    {% endif %}
    <input type="submit" value="Search" />
  </form>

  {% if query or request.args.getlist('tags') %}
    <h2>Search results</h2>
    {% if not recipes %}
      <p>No recipes found matching the search query.</p>
    {% else %}
      <p>Found a total of {{ recipe_count }} matching recipe{{ 's' if recipe_count != 1 else '' }}, showing {{ (page - 1) * 10 + 1 }} to {{ (page - 1) * 10 + recipes|length }}.</p>
      {% block list_recipes scoped %}
        {{ super() }}
      {% endblock %}
      <p>
        {% if page > 1 %}
          <a href="{{ url_for('search', page=page-1, query=query, tags=request.args.getlist('tags')) }}">&lt; Previous</a>
        {% endif %}
        Page {{ page }} of {{ page_count }}
        {% if page < page_count %}
          <a href="{{ url_for('search', page=page+1, query=query, tags=request.args.getlist('tags')) }}">Next &gt;</a>
        {% endif %}
      </p>
    {% endif %}
  {% endif %}
{% endblock %}